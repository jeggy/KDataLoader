name: Build test lib and publish Docs

on: [push]

jobs:
    test-and-build:
        name: Test and Build
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v1
            -   name: Set up JDK 11
                uses: actions/setup-java@v1
                with:
                    java-version: 11
            -   name: Test
                run: ./gradlew check
            -   name: Build
                run: ./gradlew assemble

    publish-documentation:
        needs: test-and-build
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v1
            -   uses: actions/setup-node@v1
                with:
                    node-version: 12
                    registry-url: https://registry.npmjs.org/
            -   run: npm i -g @antora/cli@2.2 @antora/site-generator-default@2.2
            -   run: antora antora-playbook.yml
